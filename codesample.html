<!DOCTYPE html>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>Specimen | Aric Gardner</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
	<link rel="stylesheet" href="/assets/css/main.css" />
	<link rel="stylesheet" href="/assets/css/syntax_monokai.css" />

	<!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V0N7JSQ91Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-V0N7JSQ91Z');
</script>
 
</head> 


<body>

    <!-- Wrapper -->
<div id="wrapper">

<!-- Header -->
<header id="header">
	<a href="" class="logo"><strong>Aric Gardner</strong> <span>Release Engineering</span></a>
	<nav>
		<a href="#menu">Menu</a>
	</nav>
</header>

<!-- Menu -->
<nav id="menu">
	<ul class="links">
        
		    
		
		    
		
		    
		
		    
		
		    
		
		    
		
		    
		        <li><a href="/">Home</a></li>
	    	
		
		    
		
		    
		
		
		    
		
		    
		        <li><a href="/aboutme.html">Self</a></li>
		    
		
		    
		        <li><a href="/codesample.html">Specimen</a></li>
		    
		
		    
		        <li><a href="/cv.html">CURRICULUM VITAE</a></li>
		    
		
		    
		        <li><a href="/env.html">~/</a></li>
		    
		
		    
		
		    
		
	</ul>
<!--
	<ul class="actions vertical">
		<li><a href="#" class="button special fit">Get Started</a></li>
		<li><a href="#" class="button fit">Log In</a></li>
	</ul>
-->
</nav>
 
    
    
<!-- Main -->
<div id="main" class="alt">

<!-- One -->
<section id="one">
	<div class="inner">
		<header class="major">
			<h1>Specimen</h1>
		</header>
		<span class="image main"><img src="/assets/images/pic01.jpg" alt="" /></span>
		<!-- Main
<div id="main" class="alt">
<section id="one">
	<div class="inner">
<p>Here are some code snippits with links to their souce on github</p>
-->

<header class="major">
  <h1>Personal Specimines</h1>
</header>
<h3 id="examples-of-my-authored-open-source-code">Examples of my authored open-source code</h3>

<blockquote>
  <p>Automation relies on steps or interactions being generalizable.<br />
For every task you automate you make the system a little less resilient.<br />
Keep things simple and solve only the problems you know you have.</p>
</blockquote>

<h2 id="gpt-openai-chat-completion-cli">GPT OpenAI Chat Completion CLI</h2>
<p><a href="https://github.com/Aricg/openai-gpt-api">GPT4 in my terminal</a><br /></p>

<p>A Script that provides a command-line interface (CLI) to interact with the OpenAI GPT models (GPT-3 and GPT-4) for chat completion tasks. It allows users to provide input via text files or command output and select a predefined prompt. The script also supports editing the message using a text editor (Vim) and saving input-output pairs for future reference.</p>

<h2 id="dns-text-record-monitor">DNS Text Record Monitor</h2>
<p><a href="https://github.com/Aricg/dns-text-record-monitor">DNS Text Record Monitor</a><br /></p>
<ul>
  <li>Complete with Docker build and python unit tests.</li>
</ul>

<header class="major">
  <h1>Work Specimines</h1>
</header>
<h3 id="the-linux-foundation-did-much-of-its-work-in-the-open-allowing-it-to-be-shared-here">The Linux Foundation did much of its work in the open, allowing it to be shared here.</h3>

<h2 id="lftoolsglobal-jjb">LFTOOLS/GLOBAL-JJB</h2>

<ul>
  <li>LFtools is a CLI script that acts as the glue between components in LFâ€™s CI infrastructure</li>
  <li>Global-jjb is a common jenkins job builder base for LF projects</li>
  <li>Featured work culminated jenkins driven automation:
    <ul>
      <li>Artifact promotion for both Maven and Docker containers (release jobs)</li>
      <li>New project creation</li>
      <li>Documentation builds</li>
      <li>Committer promotion</li>
    </ul>
  </li>
</ul>

<p><a href="https://github.com/lfit/releng-global-jjb/commit/d473edacae5c8da2b4da50e6d41b2a1c52316813">Artifact promotion initial commit</a><br />
<a href="https://gerrit.onap.org/r/c/policy/models/+/128499">Example release job</a><br />
<a href="https://gerrit.linuxfoundation.org/infra/c/releng/info-master/+/69925">New project creation</a><br />
<a href="https://github.com/lfit/releng-global-jjb/blob/master/shell/rtdv3.sh">Read the docs shell script</a><br />
<a href="https://gerrit.onap.org/r/c/policy/parent/+/128484">Read the docs example build</a> (Onap)<br />
<a href="https://docs.onap.org/en/latest/">Onap RTD main page</a><br />
<a href="https://gerrit.onap.org/r/c/cps/ncmp-dmi-plugin/+/128368">Example committer promotion</a><br /></p>

<figure class="highlight"><pre><code class="language-none" data-lang="none">Usage: lftools gerrit [OPTIONS] COMMAND [ARGS]...

  GERRIT TOOLS.

Options:
  --help  Show this message and exit.

Commands:
  abandonchanges              Abandon all OPEN changes for a gerrit project.
  addfile                     Add a file for review to a Project.
  addgithubrights             Grant Github read for a project.
  addgitreview                Add git review to a project.
  addinfojob                  Add an INFO job for a new Project.
  addmavenconfig              Add maven config file for JCasC.
  create-saml-group           Create saml group based on ldap group.
  createproject               Create a project via the gerrit API.
  list-project-inherits-from  List who a project inherits from.
  list-project-permissions    List Owners of a Project.</code></pre></figure>

<p><a href="https://docs.releng.linuxfoundation.org/projects/lftools/en/latest/commands/gerrit.html">link to lftools gerrit docs</a></p>

<details>
<summary> gerrit.py </summary>


<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/usr/bin/env python3
# SPDX-License-Identifier: EPL-1.0
##############################################################################
# Copyright (c) 2018 The Linux Foundation and others.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Eclipse Public License v1.0
# which accompanies this distribution, and is available at
# http://www.eclipse.org/legal/epl-v10.html
##############################################################################
</span><span class="s">"""Create a gerrit project."""</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>

<span class="kn">import</span> <span class="nn">click</span>

<span class="kn">from</span> <span class="nn">lftools.api.endpoints</span> <span class="kn">import</span> <span class="n">gerrit</span>
<span class="kn">from</span> <span class="nn">lftools.git.gerrit</span> <span class="kn">import</span> <span class="n">Gerrit</span> <span class="k">as</span> <span class="n">git_gerrit</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">group</span><span class="p">()</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">gerrit_cli</span><span class="p">(</span><span class="n">ctx</span><span class="p">):</span>
    <span class="s">"""GERRIT TOOLS."""</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"addfile"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"filename"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--issue_id"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"For projects that enforce an issue id for changesets"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--file_location"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"File path within the repository"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">addfile</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">file_location</span><span class="p">):</span>
    <span class="s">"""Add a file for review to a Project.

    Requires gerrit directory.

    Example:

    gerrit_url gerrit.o-ran-sc.org/r
    gerrit_project test/test1
    """</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">add_file</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">file_location</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"addinfojob"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"jjbrepo"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--issue_id"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"For projects that enforce an issue id for changesets"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--agent"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Specify the Jenkins agent label to run the job on"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">addinfojob</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">jjbrepo</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">agent</span><span class="p">):</span>
    <span class="s">"""Add an INFO job for a new Project.

    Adds info verify jenkins job for project.
    result['id'] can be used to ammend a review
    so that multiple projects can have info jobs added
    in a single review

    Example:

    gerrit_url gerrit.o-ran-sc.org/r
    gerrit_project test/test1
    jjbrepo ci-mangement
    """</span>
    <span class="n">git</span> <span class="o">=</span> <span class="n">git_gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">jjbrepo</span><span class="p">)</span>
    <span class="n">git</span><span class="p">.</span><span class="n">add_info_job</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">agent</span><span class="p">)</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"addgitreview"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--issue_id"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"For projects that enforce an issue id for changesets"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">addgitreview</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">):</span>
    <span class="s">"""Add git review to a project.

    Example:
    gerrit_url gerrit.o-ran-sc.org
    gerrit_project test/test1
    """</span>
    <span class="n">git</span> <span class="o">=</span> <span class="n">git_gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">gerrit_project</span><span class="p">)</span>
    <span class="n">git</span><span class="p">.</span><span class="n">add_git_review</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">)</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"addgithubrights"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">addgithubrights</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">):</span>
    <span class="s">"""Grant Github read for a project.

    gerrit_url gerrit.o-ran-sc.org
    gerrit_project test/test1
    """</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">add_github_rights</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"abandonchanges"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">abandonchanges</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">):</span>
    <span class="s">"""Abandon all OPEN changes for a gerrit project.

    gerrit_url gerrit.o-ran-sc.org
    gerrit_project test/test1
    """</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">abandon_changes</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<span class="c1"># Creates a gerrit project if project does not exist and adds ldap group as owner.
# Limits: does not support inherited permissions from other than All-Projects.
</span><span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"createproject"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"ldap_group"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--description"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Project Description"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--check"</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"just check if the project exists"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">createproject</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">check</span><span class="p">):</span>
    <span class="s">"""Create a project via the gerrit API.

    Creates a gerrit project.
    Sets ldap group as owner.

    Example:

    gerrit_url gerrit.o-ran-sc.org/r
    gerrit_project test/test1
    ldap_group oran-gerrit-test-test1-committers

    """</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">create_project</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">check</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"create-saml-group"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"ldap_group"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">create_saml_group</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">):</span>
    <span class="s">"""Create saml group based on ldap group."""</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">create_saml_group</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"list-project-permissions"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">list_project_permissions</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
    <span class="s">"""List Owners of a Project."""</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">list_project_permissions</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ldap_group</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">ldap_group</span><span class="p">))</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"list-project-inherits-from"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">list_project_inherits_from</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">):</span>
    <span class="s">"""List who a project inherits from."""</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gerrit</span><span class="p">.</span><span class="n">Gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">list_project_inherits_from</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">command</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"addmavenconfig"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_fqdn"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"gerrit_project"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">argument</span><span class="p">(</span><span class="s">"jjbrepo"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--issue_id"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"For projects that enforce an issue id for changesets"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"--nexus3"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Specify a Nexus 3 server, e.g. nexus3.example.org"</span><span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">option</span><span class="p">(</span>
    <span class="s">"--nexus3_ports"</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s">"Comma-separated list of ports supported by the Nexus 3 server specified"</span><span class="p">,</span>
<span class="p">)</span>
<span class="o">@</span><span class="n">click</span><span class="p">.</span><span class="n">pass_context</span>
<span class="k">def</span> <span class="nf">addmavenconfig</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">jjbrepo</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">nexus3</span><span class="p">,</span> <span class="n">nexus3_ports</span><span class="p">):</span>
    <span class="s">"""Add maven config file for JCasC.

    </span><span class="se">\b</span><span class="s">
    The following options can be set in the gerrit server's entry in lftools.ini:
      * default_servers: Comma-separated list of servers using the &lt;projectname&gt;
        credential. Default: releases,snapshots,staging,site
      * additional_credentials: JSON-formatted string containing
        servername:credentialname pairings. This should be on a single line,
        without quotes surrounding the string.
      * nexus3: The nexus3 server url for a given project.
      * nexus3_ports: Comma-separated list of ports used by Nexus3.
        Default: 10001,10002,10003,10004

    </span><span class="se">\f</span><span class="s">
    The 'b' escape character above disables auto-formatting, so that the help
    text will follow the exact formatting used here. The 'f' escape is to keep
    this from appearing in the --help text.
    https://click.palletsprojects.com/en/latest/documentation/
    """</span>
    <span class="n">git</span> <span class="o">=</span> <span class="n">git_gerrit</span><span class="p">(</span><span class="n">fqdn</span><span class="o">=</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">jjbrepo</span><span class="p">)</span>
    <span class="n">git</span><span class="p">.</span><span class="n">add_maven_config</span><span class="p">(</span><span class="n">gerrit_fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">nexus3</span><span class="p">,</span> <span class="n">nexus3_ports</span><span class="p">)</span>


<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">addinfojob</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">addfile</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">addgitreview</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">addgithubrights</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">createproject</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">abandonchanges</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">create_saml_group</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">list_project_permissions</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">list_project_inherits_from</span><span class="p">)</span>
<span class="n">gerrit_cli</span><span class="p">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">addmavenconfig</span><span class="p">)</span></code></pre></figure>

</details>

<p><a href="https://github.com/lfit/releng-lftools/blob/master/lftools/cli/gerrit.py">link to gerrit.py</a></p>

<details>
<summary>
api/gerrit.py
</summary>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1"># SPDX-License-Identifier: EPL-1.0
##############################################################################
# Copyright (c) 2019 The Linux Foundation and others.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Eclipse Public License v1.0
# which accompanies this distribution, and is available at
# http://www.eclipse.org/legal/epl-v10.html
##############################################################################
</span>
<span class="s">"""Gerrit REST API interface."""</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="kn">import</span> <span class="nn">lftools.api.client</span> <span class="k">as</span> <span class="n">client</span>
<span class="kn">from</span> <span class="nn">lftools</span> <span class="kn">import</span> <span class="n">config</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Gerrit</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">RestApi</span><span class="p">):</span>
    <span class="s">"""API endpoint wrapper for Gerrit.

    Be sure to always include the trailing "/" when adding
    new methods.
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="s">"""Initialize the class."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">params</span><span class="p">[</span><span class="s">"fqdn"</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">"creds"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">params</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">"authtype"</span><span class="p">:</span> <span class="s">"basic"</span><span class="p">,</span>
                <span class="s">"username"</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"username"</span><span class="p">),</span>
                <span class="s">"password"</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"password"</span><span class="p">),</span>
                <span class="s">"endpoint"</span><span class="p">:</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"endpoint"</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">params</span><span class="p">[</span><span class="s">"creds"</span><span class="p">]</span> <span class="o">=</span> <span class="n">creds</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Gerrit</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">file_location</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Add a file for review to a Project.

        File can be sourced from any location
        but only lands in the root of the repo.
        unless file_location is specified
        Example:

        gerrit_url gerrit.o-ran-sc.org
        gerrit_project test/test1
        filename /tmp/INFO.yaml
        file_location="somedir/example-INFO.yaml"
        """</span>
        <span class="n">signed_off_by</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"sob"</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_change</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">signed_off_by</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_location</span><span class="p">:</span>
            <span class="n">file_location</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">file_location</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">file_location</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/"</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
        <span class="n">changeid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>

        <span class="n">my_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">my_file_size</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"Content-length"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">my_file_size</span><span class="p">)}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/edit/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">my_file</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/edit:publish"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"notify"</span><span class="p">:</span> <span class="s">"NONE"</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
        <span class="c1">##############################################################
</span>
    <span class="k">def</span> <span class="nf">add_info_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">jjbrepo</span><span class="p">,</span> <span class="n">reviewid</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Add an INFO job for a new Project.

        Adds info verify jenkins job for project.
        result['id'] can be used to ammend a review
        so that multiple projects can have info jobs added
        in a single review

        Example:

        fqdn gerrit.o-ran-sc.org
        gerrit_project test/test1
        jjbrepo ci-mangement
        """</span>
        <span class="c1">###############################################################
</span>        <span class="c1"># Setup
</span>        <span class="n">signed_off_by</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"sob"</span><span class="p">)</span>
        <span class="n">gerrit_project_dashed</span> <span class="o">=</span> <span class="n">gerrit_project</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">"{}.yaml"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project_dashed</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">reviewid</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_change</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">jjbrepo</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">signed_off_by</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/"</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">"id"</span><span class="p">])</span>
            <span class="n">changeid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">changeid</span> <span class="o">=</span> <span class="n">reviewid</span>

        <span class="k">if</span> <span class="n">fqdn</span> <span class="o">==</span> <span class="s">"gerrit.o-ran-sc.org"</span><span class="p">:</span>
            <span class="n">buildnode</span> <span class="o">=</span> <span class="s">"centos7-builder-1c-1g"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">buildnode</span> <span class="o">=</span> <span class="s">"centos7-builder-2c-1g"</span>

        <span class="n">my_inline_file</span> <span class="o">=</span> <span class="s">"""---
- project:
    name: {0}-project-view
    project-name: {0}
    views:
      - project-view</span><span class="se">\n</span><span class="s">
- project:
    name: {0}-info
    project: {1}
    project-name: {0}
    build-node: {2}
    jobs:
      - gerrit-info-yaml-verify</span><span class="se">\n</span><span class="s">"""</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">gerrit_project_dashed</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">buildnode</span>
        <span class="p">)</span>
        <span class="n">my_inline_file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_inline_file</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">))</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"Content-length"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">my_inline_file_size</span><span class="p">)}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{0}/edit/jjb%2F{1}%2F{1}.yaml"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">,</span> <span class="n">gerrit_project_dashed</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">my_inline_file</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/edit:publish"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"notify"</span><span class="p">:</span> <span class="s">"NONE"</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">vote_on_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">changeid</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Helper that votes on a change.

        POST /changes/{change-id}/revisions/{revision-id}/review
        """</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">changeid</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/revisions/2/review"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"tag"</span><span class="p">:</span> <span class="s">"automation"</span><span class="p">,</span>
                <span class="s">"message"</span><span class="p">:</span> <span class="s">"Vote on file"</span><span class="p">,</span>
                <span class="s">"labels"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"Verified"</span><span class="p">:</span> <span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">"Code-Review"</span><span class="p">:</span> <span class="o">+</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="c1"># Code for projects that don't allow self merge.
</span>        <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span> <span class="o">+</span> <span class="s">".second"</span><span class="p">):</span>
            <span class="n">second_username</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span> <span class="o">+</span> <span class="s">".second"</span><span class="p">,</span> <span class="s">"username"</span><span class="p">)</span>
            <span class="n">second_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">fqdn</span> <span class="o">+</span> <span class="s">".second"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">second_username</span><span class="p">,</span> <span class="n">second_password</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">submit_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">changeid</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Method so submit a change."""</span>
        <span class="c1"># submit a change id
</span>        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/submit"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">abandon_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""."""</span>
        <span class="n">gerrit_project_encoded</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/?q=project:{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project_encoded</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">access_str</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">"message"</span><span class="p">:</span> <span class="s">"Abandoned by automation"</span><span class="p">}</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">id</span><span class="p">[</span><span class="s">"status"</span><span class="p">])</span> <span class="o">==</span> <span class="s">"NEW"</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
                <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/abandon"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">create_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">signed_off_by</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Method to create a gerrit change."""</span>
        <span class="k">if</span> <span class="n">issue_id</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="s">"Automation adds {0}</span><span class="se">\n\n</span><span class="s">Issue-ID: {1}</span><span class="se">\n\n</span><span class="s">Signed-off-by: {2}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">signed_off_by</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="s">"Automation adds {0}</span><span class="se">\n\n</span><span class="s">Signed-off-by: {1}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">signed_off_by</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"project"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">),</span>
                <span class="s">"subject"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">subject</span><span class="p">),</span>
                <span class="s">"branch"</span><span class="p">:</span> <span class="s">"master"</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="nf">sanity_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Perform a sanity check."""</span>
        <span class="c1"># Sanity check
</span>        <span class="n">gerrit_project_encoded</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">mylist</span> <span class="o">=</span> <span class="p">[</span><span class="s">"projects/"</span><span class="p">,</span> <span class="s">"projects/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project_encoded</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">access_str</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">access_str</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
                <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Not found {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">access_str</span><span class="p">))</span>
                <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"found {} {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">mylist</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">add_git_review</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Add and Submit a .gitreview for a project.

        Example:

        fqdn gerrit.o-ran-sc.org
        gerrit_project test/test1
        issue_id: CIMAN-33
        """</span>
        <span class="n">signed_off_by</span> <span class="o">=</span> <span class="n">config</span><span class="p">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="s">"sob"</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sanity_check</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">)</span>

        <span class="c1">###############################################################
</span>        <span class="c1"># Create A change set.
</span>        <span class="n">filename</span> <span class="o">=</span> <span class="s">".gitreview"</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_change</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">issue_id</span><span class="p">,</span> <span class="n">signed_off_by</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/"</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">changeid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>

        <span class="c1">###############################################################
</span>        <span class="c1"># Add a file to a change set.
</span>        <span class="n">my_inline_file</span> <span class="o">=</span> <span class="s">"""
        [gerrit]
        host={0}
        port=29418
        project={1}
        defaultbranch=master
        """</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span>
            <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span>
        <span class="p">)</span>
        <span class="n">my_inline_file_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_inline_file</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">))</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"Content-length"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">my_inline_file_size</span><span class="p">)}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/edit/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">my_inline_file</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">409</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Conflict detected exiting"</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">access_str</span> <span class="o">=</span> <span class="s">"changes/{}/edit:publish"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">changeid</span><span class="p">)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Content-Type"</span><span class="p">:</span> <span class="s">"application/json; charset=UTF-8"</span><span class="p">}</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s">"notify"</span><span class="p">:</span> <span class="s">"NONE"</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">vote_on_change</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">changeid</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">submit_change</span><span class="p">(</span><span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">changeid</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_saml_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Create saml group from ldap group."""</span>
        <span class="c1">###############################################################
</span>        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"visible_to_all"</span><span class="p">:</span> <span class="s">"false"</span><span class="p">})</span>
        <span class="n">saml_group</span> <span class="o">=</span> <span class="s">"saml/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ldap_group</span><span class="p">)</span>
        <span class="n">saml_group_encoded</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">saml_group</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"groups/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">saml_group_encoded</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Encoded SAML group name: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">saml_group_encoded</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">add_github_rights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""Grant github read to a project."""</span>
        <span class="c1">###############################################################
</span>        <span class="c1"># Github Rights
</span>
        <span class="n">gerrit_project_encoded</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="c1"># GET /groups/?m=test%2F HTTP/1.0
</span>        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"groups/?m=GitHub%20Replication"</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">access_str</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">access_str</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">githubid</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">"GitHub Replication"</span><span class="p">][</span><span class="s">"id"</span><span class="p">]</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">githubid</span><span class="p">)</span>

        <span class="c1"># POST /projects/MyProject/access HTTP/1.0
</span>        <span class="k">if</span> <span class="n">githubid</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s">"add"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"refs/*"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">"permissions"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"read"</span><span class="p">:</span> <span class="p">{</span><span class="s">"rules"</span><span class="p">:</span> <span class="p">{</span><span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">githubid</span><span class="p">):</span> <span class="p">{</span><span class="s">"action"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"ALLOW"</span><span class="p">)}}}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">access_str</span> <span class="o">=</span> <span class="s">"projects/{}/access"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project_encoded</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pretty</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">pretty</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Error no githubid found"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">,</span> <span class="n">ldap_group</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">check</span><span class="p">):</span>
        <span class="s">"""Create a project via the gerrit API.

        Creates a gerrit project.
        Converts ldap group to saml group and sets as owner.

        Example:

        gerrit_url gerrit.o-ran-sc.org/r
        gerrit_project test/test1
        ldap_group oran-gerrit-test-test1-committers
        --description="This is a demo project"

        """</span>
        <span class="n">gerrit_project</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"projects/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">access_str</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Project not found."</span><span class="p">)</span>
            <span class="n">projectexists</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">elif</span> <span class="n">result</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Unauthorized."</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"found {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">access_str</span><span class="p">))</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">projectexists</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">projectexists</span><span class="p">:</span>
            <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Project already exists"</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">saml_group</span> <span class="o">=</span> <span class="s">"saml/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">ldap_group</span><span class="p">)</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"SAML group name: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">saml_group</span><span class="p">))</span>

        <span class="n">access_str</span> <span class="o">=</span> <span class="s">"projects/{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s">"description"</span><span class="p">:</span> <span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">description</span><span class="p">),</span>
                <span class="s">"submit_type"</span><span class="p">:</span> <span class="s">"INHERIT"</span><span class="p">,</span>
                <span class="s">"create_empty_commit"</span><span class="p">:</span> <span class="s">"True"</span><span class="p">,</span>
                <span class="s">"owners"</span><span class="p">:</span> <span class="p">[</span><span class="s">"{}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">saml_group</span><span class="p">)],</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">access_str</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">list_project_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
        <span class="s">"""List a projects owners."""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"access/?project={}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">project</span><span class="p">))[</span><span class="mi">1</span><span class="p">][</span><span class="n">project</span><span class="p">][</span><span class="s">"local"</span><span class="p">]</span>
        <span class="n">group_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">"permissions"</span><span class="p">][</span><span class="s">"owner"</span><span class="p">][</span><span class="s">"rules"</span><span class="p">].</span><span class="n">items</span><span class="p">():</span>
                <span class="n">group_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">kk</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">"ldap:cn="</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">",ou=Groups,dc=freestandards,dc=org"</span><span class="p">,</span> <span class="s">""</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">group_list</span>

    <span class="k">def</span> <span class="nf">list_project_inherits_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gerrit_project</span><span class="p">):</span>
        <span class="s">"""List who a project inherits from."""</span>
        <span class="n">gerrit_project</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">""</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"projects/{}/access"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">gerrit_project</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inherits</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s">"inherits_from"</span><span class="p">][</span><span class="s">"id"</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">inherits</span></code></pre></figure>

</details>

<p><a href="https://github.com/lfit/releng-lftools/blob/master/lftools/api/endpoints/gerrit.py">link to api/gerrit.py</a></p>

<p>The above api interface was written to replace my earlier work done in bash:<br />
<a href="https://github.com/lfit/releng-lftools/blob/master/shell/gerrit_create">shell/gerrit_create</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/shell/inactivecommitters">shell/inactivecommitters</a></p>

<figure class="highlight"><pre><code class="language-none" data-lang="none">Usage: lftools github [OPTIONS] COMMAND [ARGS]...

  GITHUB TOOLS.

Options:
  --help  Show this message and exit.

Commands:
  create-repo  Create a Github repo within an Organization.
  create-team  Create a Github team within an Organization.
  list         List options for github org repos.
  submit-pr    Submit a pr if mergeable.
  update-repo  Update a Github repo within an Organization.
  user         Add and Remove users from an org team.
  votes        Helper for votes.</code></pre></figure>

<p><a href="https://docs.releng.linuxfoundation.org/projects/lftools/en/latest/commands/github.html">lftools github documentation</a><br /></p>

<p><a href="https://github.com/lfit/releng-lftools/blob/master/lftools/cli/github_cli.py">cli/github_cli.py</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/github_helper.py">github_helper.py</a><br /></p>

<p>Info File:<br />
<a href="https://docs.releng.linuxfoundation.org/projects/lftools/en/latest/commands/infofile.html">link to documentation</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/cli/ldap_cli.py">link to ldap_cli</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/ldap_cli.py">link to ldap</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/shell/yaml4info">link to yaml4info</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/cli/infofile.py">link to infofile</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/shell/autocorrectinfofile">link to autocorrectinfofile</a><br /></p>

<p>LFID api (internal identity provider)<br />
<a href="https://docs.releng.linuxfoundation.org/projects/lftools/en/latest/commands/lfidapi.html">link to documentation</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/cli/lfidapi.py">link to lfid_cli</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/lfidapi.py">link to lfidapi</a><br />
<a href="https://github.com/lfit/releng-lftools/blob/master/lftools/oauth2_helper.py">link to oauth2_helper</a><br /></p>

<h2 id="jcasc">JcasC</h2>

<ul>
  <li>Jenkins admin configuration via code reivew:
    <ul>
      <li>Code written for JcasC allows config files in repo to manage jenkins<br /></li>
    </ul>
  </li>
</ul>

<p><a href="https://gerrit.onap.org/r/c/ci-management/+/127823">Example JcasC change</a></p>

<p>JcasC:<br />
<a href="https://github.com/lfit/releng-global-jjb/blob/master/jenkins-admin/create_jenkins_global_env_vars.py">link to parser</a><br />
<a href="https://github.com/lfit/releng-global-jjb/blob/master/jenkins-admin/create_jenkins_clouds_openstack_yaml.py">Jinja rendering</a><br /></p>

<details>
<summary>
JcasC Updater (Bash)
</summary>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#!/bin/bash
# SPDX-License-Identifier: EPL-1.0
##############################################################################
# Copyright (c) 2020 The Linux Foundation and others.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Eclipse Public License v1.0
# which accompanies this distribution, and is available at
# http://www.eclipse.org/legal/epl-v10.html
##############################################################################
</span><span class="nb">set</span> <span class="o">-</span><span class="n">euo</span> <span class="n">pipefail</span>

<span class="n">casc_d_dir</span><span class="o">=</span><span class="s">"/var/lib/jenkins/casc.d/community.d/"</span>
<span class="n">ci_man</span><span class="o">=</span><span class="s">"/opt/ci-man-repo"</span>

<span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">cd</span> <span class="s">"$1"</span> <span class="o">||</span> <span class="nb">exit</span>
  <span class="n">check_for_updates</span> <span class="c1">#Are there updates to the ci-man repo
</span>  <span class="n">mktmpdir</span>
  <span class="n">lf_venv</span>
  <span class="n">global_env_vars</span>
  <span class="n">detect_clouds</span>
  <span class="k">if</span> <span class="p">[[</span> <span class="s">"${#clouds[@]}"</span> <span class="o">-</span><span class="n">gt</span> <span class="mi">1</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">merge_clouds</span> <span class="s">"${clouds[@]%/*}"</span>
  <span class="n">fi</span>
  <span class="n">cp</span> <span class="s">"$tmpdir"</span><span class="o">/*</span><span class="p">.</span><span class="n">yaml</span> <span class="s">"$casc_d_dir"</span><span class="o">/</span>
  <span class="n">echo</span> <span class="s">"$casc_d_dir"</span>
  <span class="n">create_groovy</span>
  <span class="n">reload_casc</span>
  <span class="n">echo</span> <span class="s">"Cleaning up"</span>
  <span class="n">rm</span> <span class="s">"$groovyfile"</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="s">"$tmpdir"</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="s">"$tmpdirnomadyaml"</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="s">"$lf_venv"</span>
  <span class="n">echo</span> <span class="s">"INFO: Jcasc updated"</span>
<span class="p">}</span>

<span class="n">check_for_updates</span><span class="p">(){</span>
  <span class="n">OLD_GIT_COMMIT</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">git</span> <span class="n">rev</span><span class="o">-</span><span class="n">parse</span> <span class="n">HEAD</span><span class="p">)</span>
  <span class="n">git</span> <span class="n">pull</span> <span class="o">--</span><span class="n">quiet</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span>
  <span class="n">NEW_GIT_COMMIT</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">git</span> <span class="n">rev</span><span class="o">-</span><span class="n">parse</span> <span class="n">HEAD</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">[[</span> <span class="s">"$OLD_GIT_COMMIT"</span> <span class="o">!=</span> <span class="s">"$NEW_GIT_COMMIT"</span> <span class="p">]];</span> <span class="n">then</span>

  <span class="n">jenkins_config_files</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">git</span> <span class="n">diff</span><span class="o">-</span><span class="n">tree</span> \
  <span class="o">-</span><span class="n">m</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">commit</span><span class="o">-</span><span class="nb">id</span> \
  <span class="o">-</span><span class="n">r</span> <span class="s">"$NEW_GIT_COMMIT"</span> <span class="s">"$OLD_GIT_COMMIT"</span> \
  <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">--</span> <span class="s">"jenkins-config/"</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">((</span> <span class="err">$</span><span class="p">(</span><span class="n">grep</span> <span class="o">-</span><span class="n">c</span> <span class="p">.</span> <span class="o">&lt;&lt;&lt;</span><span class="s">"$jenkins_config_files"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">));</span> <span class="n">then</span>
      <span class="n">echo</span> <span class="s">"INFO: Modified config files found: $jenkins_config_files"</span>
    <span class="k">else</span>
      <span class="nb">exit</span> <span class="mi">0</span> <span class="c1">#No updates
</span>    <span class="n">fi</span>
  <span class="k">else</span>
    <span class="nb">exit</span> <span class="mi">0</span> <span class="c1">#No updates
</span>  <span class="n">fi</span>
<span class="p">}</span>


<span class="n">lf_venv</span><span class="p">(){</span>
  <span class="n">source</span> <span class="k">global</span><span class="o">-</span><span class="n">jjb</span><span class="o">/</span><span class="n">jenkins</span><span class="o">-</span><span class="n">init</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">lf</span><span class="o">-</span><span class="n">env</span><span class="p">.</span><span class="n">sh</span>
  <span class="n">lf</span><span class="o">-</span><span class="n">activate</span><span class="o">-</span><span class="n">venv</span> <span class="n">lftools</span> <span class="n">jinja2</span> <span class="n">ruamel</span><span class="p">.</span><span class="n">yaml</span>
<span class="p">}</span>

<span class="n">reload_casc</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">lftools</span> <span class="n">jenkins</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;%=</span> <span class="o">@</span><span class="n">casc_jenkins_url_stripped</span> <span class="o">%&gt;</span> <span class="n">groovy</span> <span class="s">"$groovyfile"</span>
<span class="p">}</span>

<span class="n">merge_clouds</span><span class="p">(){</span>
  <span class="n">yq3</span> <span class="n">m</span> <span class="o">-</span><span class="n">a</span> <span class="n">append</span> <span class="s">"$tmpdir"</span><span class="o">/</span><span class="s">"$1"</span><span class="p">.</span><span class="n">yaml</span> <span class="s">"$tmpdir"</span><span class="o">/</span><span class="s">"$2"</span><span class="p">.</span><span class="n">yaml</span> <span class="o">&gt;</span> <span class="s">"$tmpdir"</span><span class="o">/</span><span class="n">clouds</span><span class="p">.</span><span class="n">yaml</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="s">"$tmpdir"</span><span class="o">/</span><span class="s">"$1"</span><span class="p">.</span><span class="n">yaml</span> <span class="s">"$tmpdir"</span><span class="o">/</span><span class="s">"$2"</span><span class="p">.</span><span class="n">yaml</span>
<span class="p">}</span>

<span class="n">mktmpdir</span><span class="p">(){</span>
  <span class="n">tmpdir</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mktemp</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
  <span class="n">tmpdirnomadyaml</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mktemp</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">create_groovy</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">groovyfile</span><span class="o">=</span><span class="s">"$(mktemp)"</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span><span class="n">EOF</span> <span class="o">&gt;</span> <span class="s">"$groovyfile"</span>
<span class="kn">import</span> <span class="nn">io.jenkins.plugins.casc.ConfigurationAsCode</span><span class="p">;</span>
<span class="n">ConfigurationAsCode</span><span class="p">.</span><span class="n">get</span><span class="p">().</span><span class="n">configure</span><span class="p">()</span>
<span class="n">EOF</span>
<span class="p">}</span>

<span class="n">global_env_vars</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="err">!</span> <span class="p">[[</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="n">casc_d_dir</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"casc.d dir '$casc_d_dir' not found."</span>
    <span class="nb">exit</span> <span class="mi">1</span>
  <span class="n">fi</span>
  <span class="n">python</span> <span class="k">global</span><span class="o">-</span><span class="n">jjb</span><span class="o">/</span><span class="n">jenkins</span><span class="o">-</span><span class="n">admin</span><span class="o">/</span><span class="n">create_jenkins_global_env_vars</span><span class="p">.</span><span class="n">py</span> \
    <span class="o">--</span><span class="n">path</span><span class="o">=</span><span class="n">jenkins</span><span class="o">-</span><span class="n">config</span><span class="o">/</span> <span class="o">&lt;%</span> <span class="k">if</span> <span class="o">@</span><span class="n">casc_jenkins_url_stripped</span><span class="p">.</span><span class="n">include</span><span class="err">?</span> <span class="s">"sandbox"</span> <span class="o">%&gt;--</span><span class="n">sandbox</span><span class="o">&lt;%</span> <span class="n">end</span> <span class="o">%&gt;</span>
<span class="p">}</span>

<span class="n">nomad</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="s">"$2 detected with name $1"</span>
  <span class="n">ls</span> <span class="s">"$cloud_path/$2/$1/"</span>
  <span class="n">cloudcfg</span><span class="o">=</span><span class="s">"$cloud_path/$2/$1/cloud.yaml"</span>
  <span class="n">cloud_cfg_check</span> <span class="s">"$cloudcfg"</span>
  <span class="n">files</span><span class="o">=</span><span class="p">()</span>
  <span class="n">cd</span> <span class="s">"$cloud_path/$2/$1/"</span> <span class="o">||</span> <span class="nb">exit</span>
  <span class="k">while</span> <span class="n">read</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">;</span> <span class="n">do</span>
     <span class="k">if</span> <span class="p">[[</span> <span class="err">$</span><span class="n">REPLY</span> <span class="o">=~</span> <span class="n">main</span><span class="p">.</span><span class="n">yaml</span> <span class="p">]];</span><span class="n">then</span>
       <span class="n">cloudfile</span><span class="o">=</span><span class="err">$</span><span class="n">REPLY</span>
     <span class="k">elif</span> <span class="p">[[</span> <span class="err">$</span><span class="n">REPLY</span> <span class="o">=~</span> <span class="n">sandbox</span><span class="p">.</span><span class="n">yaml</span> <span class="p">]];</span><span class="n">then</span>
       <span class="n">sandboxfile</span><span class="o">=</span><span class="err">$</span><span class="n">REPLY</span>
     <span class="k">elif</span> <span class="p">[[</span> <span class="err">$</span><span class="n">REPLY</span> <span class="o">=~</span> <span class="n">defaults</span><span class="p">.</span><span class="n">yaml</span> <span class="p">]];</span><span class="n">then</span>
       <span class="n">defaultsfile</span><span class="o">=</span><span class="err">$</span><span class="n">REPLY</span>
     <span class="k">else</span>
       <span class="n">files</span><span class="o">+=</span><span class="p">(</span><span class="s">"$REPLY"</span><span class="p">)</span>
     <span class="n">fi</span>
  <span class="n">done</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">find</span> <span class="p">.</span> <span class="o">-</span><span class="n">name</span> <span class="s">"*.yaml"</span> <span class="p">)</span>


  <span class="n">cp</span> <span class="s">"${files[@]}"</span> <span class="s">"$tmpdirnomadyaml"</span>
  <span class="o">&lt;%</span> <span class="k">if</span> <span class="o">@</span><span class="n">casc_jenkins_url_stripped</span><span class="p">.</span><span class="n">include</span><span class="err">?</span> <span class="s">"sandbox"</span> <span class="o">%&gt;</span><span class="n">cloudfile</span><span class="o">=</span><span class="s">"$sandboxfile"</span><span class="o">&lt;%</span> <span class="n">end</span> <span class="o">%&gt;</span>
  <span class="n">cp</span> <span class="err">$</span><span class="n">cloudfile</span> <span class="s">"$tmpdirnomadyaml"</span>
  <span class="n">cp</span> <span class="err">$</span><span class="n">defaultsfile</span> <span class="s">"$tmpdirnomadyaml"</span>

  <span class="n">cd</span> <span class="s">"$tmpdirnomadyaml"</span> <span class="o">||</span> <span class="nb">exit</span>

  <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="err">$</span><span class="p">{</span><span class="n">files</span><span class="p">[</span><span class="o">@</span><span class="p">]};</span> <span class="n">do</span>
      <span class="n">yq3</span> <span class="n">merge</span> <span class="s">"$file"</span> <span class="s">"$defaultsfile"</span> <span class="o">&gt;</span> <span class="n">tmpfile</span>
      <span class="n">cp</span> <span class="n">tmpfile</span> <span class="s">"$file"</span>
  <span class="n">done</span>

  <span class="n">yq3</span> <span class="n">merge</span> <span class="o">--</span><span class="n">arrays</span> <span class="n">append</span> <span class="s">"${files[@]}"</span> <span class="o">&gt;</span> <span class="n">umerged</span><span class="p">.</span><span class="n">yaml</span>
  <span class="n">yq3</span> <span class="n">p</span> <span class="o">--</span> <span class="n">umerged</span><span class="p">.</span><span class="n">yaml</span>  <span class="s">"jenkins.clouds[+] nomad"</span> <span class="o">&gt;</span> <span class="n">nmerged</span><span class="p">.</span><span class="n">yaml</span>
  <span class="n">yq3</span> <span class="n">m</span> <span class="o">--</span><span class="n">arrays</span> <span class="n">update</span> <span class="s">"$cloudfile"</span> <span class="n">nmerged</span><span class="p">.</span><span class="n">yaml</span> <span class="o">&gt;</span> <span class="s">"$tmpdir/nomad.yaml"</span>
  <span class="n">yq3</span> <span class="n">w</span> <span class="o">--</span><span class="n">inplace</span> <span class="o">-</span><span class="n">d</span><span class="s">'*'</span> <span class="s">"$tmpdir/nomad.yaml"</span> <span class="s">'jenkins.clouds[0].nomad.templates[*].password'</span> <span class="s">'&lt;%= @nomad_dockerhub_password %&gt;'</span>
  <span class="n">cd</span> <span class="o">-</span>
  <span class="n">echo</span> <span class="s">"Nomad jcasc updated"</span>
<span class="p">}</span>

<span class="n">openstack</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">echo</span> <span class="s">"$2 detected with name $1"</span>
  <span class="n">ls</span> <span class="s">"$cloud_path/$2/$1/"</span>
  <span class="n">cloudcfg</span><span class="o">=</span><span class="s">"$cloud_path/$2/$1/cloud.cfg"</span>
  <span class="n">cloud_cfg_check</span> <span class="s">"$cloudcfg"</span>
  <span class="n">python</span> <span class="k">global</span><span class="o">-</span><span class="n">jjb</span><span class="o">/</span><span class="n">jenkins</span><span class="o">-</span><span class="n">admin</span><span class="o">/</span><span class="n">create_jenkins_clouds_openstack_yaml</span><span class="p">.</span><span class="n">py</span> \
    <span class="o">--</span><span class="n">path</span><span class="o">=</span><span class="n">jenkins</span><span class="o">-</span><span class="n">config</span><span class="o">/</span> <span class="o">&lt;%</span> <span class="k">if</span> <span class="o">@</span><span class="n">casc_jenkins_url_stripped</span><span class="p">.</span><span class="n">include</span><span class="err">?</span> <span class="s">"sandbox"</span> <span class="o">%&gt;--</span><span class="n">sandbox</span><span class="o">&lt;%</span> <span class="n">end</span> <span class="o">%&gt;</span> \
    <span class="o">--</span><span class="n">name</span> <span class="s">"$1"</span> <span class="o">&gt;</span> <span class="s">"$tmpdir/openstack.yaml"</span>

<span class="p">}</span>

<span class="n">cloud_cfg_check</span><span class="p">(){</span>
  <span class="k">if</span> <span class="err">!</span> <span class="p">[[</span> <span class="o">-</span><span class="n">f</span> <span class="err">$</span><span class="n">cloudcfg</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">echo</span> <span class="s">"No cloud config found"</span>
    <span class="nb">exit</span> <span class="mi">1</span>
  <span class="n">fi</span>
  <span class="n">echo</span> <span class="s">"$cloudcfg cloud config found"</span>
<span class="p">}</span>

<span class="n">detect_clouds</span><span class="p">(){</span>
  <span class="n">cloud_path</span><span class="o">=</span><span class="s">"jenkins-config/clouds"</span>
  <span class="k">if</span> <span class="p">[[</span> <span class="o">-</span><span class="n">d</span> <span class="s">"$cloud_path"</span> <span class="p">]];</span> <span class="n">then</span>
    <span class="n">clouds</span><span class="o">=</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">read</span> <span class="o">-</span><span class="n">d</span> <span class="err">$</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">;</span> <span class="n">do</span>
      <span class="n">clouds</span><span class="o">+=</span><span class="p">(</span><span class="s">"$REPLY"</span><span class="p">)</span>
    <span class="n">done</span> <span class="o">&lt;</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">find</span> <span class="s">"$cloud_path"</span> <span class="o">-</span><span class="nb">type</span> <span class="n">d</span>  <span class="o">|</span> <span class="n">awk</span> <span class="o">-</span><span class="sa">F</span><span class="s">"/clouds/"</span> <span class="s">'{ print $2 } '</span> <span class="o">|</span> <span class="n">grep</span> <span class="s">"/"</span><span class="p">)</span>
  <span class="n">fi</span>

  <span class="c1">#run functions based on cloud name
</span>  <span class="k">for</span> <span class="n">cloud</span> <span class="ow">in</span> <span class="s">"${clouds[@]}"</span><span class="p">;</span> <span class="n">do</span>
    <span class="s">"${cloud%/*}"</span> <span class="s">"${cloud##*/}"</span> <span class="s">"${cloud%/*}"</span>
  <span class="n">done</span>
<span class="p">}</span>

<span class="n">main</span> <span class="err">$</span><span class="n">ci_man</span></code></pre></figure>

</details>


	</div>
</section>

</div>

    <!-- Footer -->
	<footer id="footer">
		<div class="inner">
		  <span class="icon alt fa-envelope"></span>
		  <a href="mailto:actual@aricgardner.com">actual@aricgardner.com</a>
			<ul class="icons">
				
					
						<li>
							<a href="https://github.com/aricg" class="icon alt fa-github" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
								<span class="label">GitHub</span>
							</a>
						</li>
					
				
					
						<li>
							<a href="https://www.linkedin.com/in/aricgardner/" class="icon alt fa-linkedin" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
								<span class="label">LinkedIn</span>
							</a>
						</li>
					
				
			</ul>

    <!-- Adding the Ï€ symbol here -->
    <p class="pi-symbol">Ï€</p>
		</div>
	</footer>

</div>

<!-- Scripts -->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/jquery.scrolly.min.js"></script>
	<script src="/assets/js/jquery.scrollex.min.js"></script>
	<script src="/assets/js/skel.min.js"></script>
	<script src="/assets/js/util.js"></script>
	<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
	<script src="/assets/js/main.js"></script>
<script>
    document.querySelector('.pi-symbol').addEventListener('click', function(e) {
        if (e.ctrlKey) {
            window.location.href = '/keys/';
        }
    });
</script>


</body>

</html>
